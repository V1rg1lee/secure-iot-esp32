<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>KMS Logs</title>
    <style>
        body {
            font-family: monospace;
            background: #111;
            color: #0f0;
            padding: 20px;
        }
        .log {
            margin-bottom: 6px;
            padding: 5px;
            border-bottom: 1px solid #333;
        }
    </style>
</head>
<body>

<h2>KMS Logs</h2>
<div id="logs">Chargement…</div>

<script>
async function loadLogs() {
    try {
        const res = await fetch("http://localhost:8000/events");
        const text = await res.text();

        const logDiv = document.getElementById("logs");
        logDiv.innerHTML = "";  // reset

        const lines = text.split("\n");

        for (const line of lines) {
            if (line.trim().length === 0) continue; // ignore empty lines

            try {
                const obj = JSON.parse(line);

                const div = document.createElement("div");
                div.className = "log";
                div.textContent = `[${obj.timestamp}] ${obj.client_id} - ${obj.topic_name} => ${obj.data}`;
                logDiv.appendChild(div);

            } catch {
                // ignore bad lines silently
                console.warn("Ligne ignorée (JSON invalide):", line);
            }
        }

    } catch (err) {
        console.error("Erreur fetch:", err);
        document.getElementById("logs").innerHTML = "Erreur de chargement.";
    }
}

// reload ever second
setInterval(loadLogs, 1000);
loadLogs();
</script>

</body>
</html>
